<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>API Test</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>API Test Page</h1>
    
    <div class="card">
      <h2>API Route Test</h2>
      <div>
        <button id="test-swa" class="button">Test SWA Route</button>
        <button id="test-direct" class="button">Test Direct Azure Function</button>
      </div>
      <pre id="result" style="background:#222; color:#fff; padding:10px; margin-top:10px; white-space: pre-wrap;"></pre>
    </div>
    
    <p><a href="/" class="button">Back to Home</a></p>
  </div>
  
  <script>
    document.getElementById('test-swa').addEventListener('click', async () => {
      const resultElement = document.getElementById('result');
      resultElement.textContent = 'Testing SWA API route...';
      
      try {
        const response = await fetch('/api/getSasToken?blobName=test.txt');
        
        // Get all response headers
        const headers = {};
        response.headers.forEach((value, name) => {
          headers[name] = value;
        });
        
        let result = `Status: ${response.status} ${response.statusText}\n`;
        result += `Content-Type: ${headers['content-type'] || 'none'}\n\n`;
        result += `Headers:\n${JSON.stringify(headers, null, 2)}\n\n`;
        
        try {
          const data = await response.json();
          result += 'Response (JSON):\n' + JSON.stringify(data, null, 2);
        } catch (e) {
          result += `Parse error: ${e.message}\n`;
          const text = await response.text();
          result += 'Response (first 300 chars):\n' + text.substring(0, 300);
          if (text.length > 300) result += '...';
        }
        
        resultElement.textContent = result;
      } catch (error) {
        resultElement.textContent = `Error: ${error.message}`;
      }
    });
    
    document.getElementById('test-direct').addEventListener('click', async () => {
      const resultElement = document.getElementById('result');
      resultElement.textContent = 'Testing direct Azure Function call...';
      
      try {
        const response = await fetch(
          'https://maanit-func.azurewebsites.net/api/getSasToken?blobName=test.txt',
          {
            method: 'GET',
            credentials: 'include',
            headers: {
              'Accept': 'application/json'
            }
          }
        );
        
        // Get all response headers
        const headers = {};
        response.headers.forEach((value, name) => {
          headers[name] = value;
        });
        
        let result = `Status: ${response.status} ${response.statusText}\n`;
        result += `Content-Type: ${headers['content-type'] || 'none'}\n\n`;
        result += `Headers:\n${JSON.stringify(headers, null, 2)}\n\n`;
        
        try {
          const data = await response.json();
          result += 'Response (JSON):\n' + JSON.stringify(data, null, 2);
        } catch (e) {
          result += `Parse error: ${e.message}\n`;
          const text = await response.text();
          result += 'Response (first 300 chars):\n' + text.substring(0, 300);
          if (text.length > 300) result += '...';
        }
        
        resultElement.textContent = result;
      } catch (error) {
        resultElement.textContent = `Error: ${error.message}`;
      }
    });
  </script>
</body>
</html>