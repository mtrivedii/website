<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>User Directory</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>User Directory</h1>
    <table>
      <thead>
        <tr><th>ID</th><th>Email</th><th>Role</th></tr>
      </thead>
      <tbody id="users">
        <tr><td colspan="3">Loading…</td></tr>
      </tbody>
    </table>
    <p><a class="button" href="index.html">← Home</a></p>
  </div>

  <script>
    async function loadUsers() {
      const tbody = document.getElementById('users');
      try {
        const res = await fetch('/api/users', {
          method: 'GET',
          credentials: 'include'    // ← include the AAD auth cookie
        });
        if (!res.ok) throw new Error(res.status);
        const users = await res.json();

        // clear “Loading…” row
        tbody.innerHTML = '';

        users.forEach(u => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${u.id}</td><td>${u.email}</td><td>${u.role}</td>`;
          tbody.appendChild(tr);
        });
      }
      catch (e) {
        console.error('Failed to load users:', e);
        tbody.innerHTML = `<tr><td colspan="3">Error loading users.</td></tr>`;
      }
    }

    loadUsers();
  </script>
</body>
</html>
